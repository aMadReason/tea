{"version":3,"sources":["webcomponents/Game.js"],"names":["css","markup","values","Component","_hasShadow","dom","attachShadow","mode","subs","template","document","createElement","innerHTML","window","ShadyCSS","prepareTemplate","tag","instance","importNode","content","styleElement","appendChild","_setElements","value","G","console","log","scene","querySelector","responder","commander","event","CustomEvent","detail","dispatchEvent","name","oldValue","newValue","addEventListener","e","handleSubmit","handleClick","removeEventListener","target","composedPath","tagName","dataset","noun","described","verb","location","getActiveLocation","things","getThingsByInsideKey","key","found","getThingsByNoun","thing","cmd","command","txt","response","getActionKeys","map","replaceVerb","text","replace","updateScene","stopPropagation","preventDefault","children","res","desc","callMethod","thingDescs","i","replaceNoun","join","HTMLElement","customElements","get","undefined","define"],"mappings":"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","file":"Game.d83b10e8.js","sourceRoot":"..","sourcesContent":["/* global ShadyCSS */\r\nconst css = `\r\n\r\n  .responder {\r\n    height: 100px;\r\n  }\r\n\r\n  .commander textarea {\r\n    width: 100%;    \r\n  }\r\n\r\n`;\r\n\r\nconst markup = values => `\r\n  <style>${values.css}</style>\r\n  <div>\r\n  <article>\r\n    <div class=\"scene\">scene</div>    \r\n    <div class=\"responder\"></div>    \r\n  </article>\r\n  <form class=\"commander\">\r\n    <input type=\"text\">\r\n    <button type=\"submit\">Go</button>\r\n  </form>\r\n  </div>\r\n`;\r\n\r\nclass Component extends HTMLElement {\r\n  constructor() {\r\n    super(); // !required!\r\n    this._hasShadow = true; // true or fals to disable or enable shadow dom\r\n    this.dom = this._hasShadow ? this.attachShadow({ mode: \"open\" }) : this;\r\n    this.subs = {};\r\n\r\n    // setup your template\r\n    const template = document.createElement(\"template\");\r\n    // we're using innerHTML but you could manually create each element and add to this._elements for complex use-cases\r\n    template.innerHTML = markup({ css });\r\n\r\n    /* Style Polyfill Step 1 */\r\n    if (window.ShadyCSS) ShadyCSS.prepareTemplate(template, Component.tag); // eslint-disable-line\r\n    /* END Style Polyfill Step 1 */\r\n\r\n    this.instance = document.importNode(template.content, true); // copy template contents into 'this'\r\n\r\n    /* Style Polyfill Step 2 */\r\n    if (window.ShadyCSS) ShadyCSS.styleElement(this); // eslint-disable-line\r\n    /* END Style Polyfill Step 2 */\r\n\r\n    this.dom.appendChild(this.instance);\r\n    this._setElements();\r\n    return this;\r\n  }\r\n\r\n  get game() {\r\n    return this.G;\r\n  }\r\n\r\n  setGame(value) {\r\n    this.G = value;\r\n    console.log(this.G);\r\n    // if (this.G && this.G.pubsub) {\r\n    //   this.G.pubsub.subscribe(\"location-change\", () => console.log(123));\r\n    // }\r\n    // this.updateScene();\r\n  }\r\n\r\n  static get observedAttributes() {\r\n    return [];\r\n  }\r\n\r\n  _setElements() {\r\n    this.G = null;\r\n    this.scene = this.dom.querySelector(\".scene\");\r\n    this.responder = this.dom.querySelector(\".responder\");\r\n    this.commander = this.dom.querySelector(\".commander\");\r\n    // const focusables = this.querySelectorAll(\r\n    //   \"a, input, button, textarea, [tabindex='0'], [contenteditable='true']\"\r\n    // );\r\n    // this.elements = [...[].slice.call(focusables)];\r\n  }\r\n\r\n  _dispatch() {\r\n    const event = new CustomEvent(\"tea-event\", { detail: {} });\r\n    this.dispatchEvent(event);\r\n  }\r\n\r\n  attributeChangedCallback(name, oldValue, newValue) {\r\n    if (oldValue === newValue) return false; // if value hadn't changed do nothing\r\n    return this;\r\n  }\r\n\r\n  connectedCallback() {\r\n    this.commander.addEventListener(\"submit\", e => this.handleSubmit(e));\r\n    this.addEventListener(\"click\", e => this.handleClick(e));\r\n  }\r\n  disconnectedCallback() {\r\n    this.commander.removeEventListener(\"submit\", e => this.handleSubmit(e));\r\n    this.removeEventListener(\"click\", e => this.handleClick(e));\r\n  }\r\n\r\n  handleClick(e) {\r\n    const target = e.composedPath()[0];\r\n    if (target.tagName !== \"BUTTON\") return true;\r\n    const { noun, described, verb } = target.dataset;\r\n    if (!noun) return true;\r\n\r\n    const location = this.G.getActiveLocation();\r\n    const things = this.G.getThingsByInsideKey(location.key);\r\n    const found = this.G.getThingsByNoun(noun, described, things);\r\n    const thing = found[0];\r\n\r\n    const cmd = this.G.command(`${verb} ${thing.name}`);\r\n    let txt = cmd.response();\r\n\r\n    thing.getActionKeys().map(key => (txt = this.replaceVerb(txt, key, thing)));\r\n    this.responder.innerHTML = txt;\r\n  }\r\n\r\n  replaceNoun(text, thing) {\r\n    const { noun, described } = thing;\r\n    return text.replace(\r\n      noun,\r\n      `<button data-verb=\"help\" data-described=\"${described}\" data-noun=\"${noun}\">${noun}</button>`\r\n    );\r\n  }\r\n\r\n  replaceVerb(text, verb, thing) {\r\n    const { described, noun } = thing;\r\n    return text.replace(\r\n      verb,\r\n      `<button data-verb=\"${verb}\" data-described=\"${described}\" data-noun=\"${noun}\">${verb}</button>`\r\n    );\r\n  }\r\n\r\n  subHandler(name = \"command\") {\r\n    if (name === \"location-change\") {\r\n      console.log(\"location-change\");\r\n      this.updateScene();\r\n    }\r\n\r\n    if (name === \"command\") {\r\n      console.log(\"command\");\r\n    }\r\n  }\r\n\r\n  handleSubmit(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n    const txt = this.commander.children[0].value;\r\n    const res = this.G.command(txt);\r\n    this.responder.innerHTML = res.response();\r\n  }\r\n\r\n  updateScene() {\r\n    const location = this.G.getActiveLocation();\r\n    const things = this.G.getThingsByInsideKey(location.key);\r\n    const desc = location.callMethod(\"describe\");\r\n\r\n    const thingDescs = things.map(i => {\r\n      let txt = i.callMethod(\"describe\");\r\n      return this.replaceNoun(txt, i);\r\n    });\r\n\r\n    let content = `\r\n      <p>${desc}</p>      \r\n      <ul>\r\n        ${thingDescs.map(i => `<li>${i}</li>`).join(``)}\r\n      </ul>\r\n    `;\r\n\r\n    this.scene.innerHTML = content;\r\n  }\r\n}\r\n\r\nconst tag = \"tea-game-el\";\r\nif (window.customElements.get(tag) === undefined) {\r\n  window.customElements.define(tag, Component);\r\n}\r\n\r\n// magic that registers the tag\r\nexport default Component;\r\n"]}